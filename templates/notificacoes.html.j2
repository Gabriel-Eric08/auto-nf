<!DOCTYPE html>
<html lang="pt-br" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Notificações - Sec. Mulher PE</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #6f42c1;
            --primary-light: #f3e5f5;
            --bg-body: #f8f9fa;
            --card-bg: #ffffff;
            --text-main: #333;
            --text-muted: #6c757d;
            --border-color: #e9ecef;
            /* Alertas */
            --status-success: #28a745;
            --status-warning: #ffc107;
            --status-danger: #dc3545;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
        }

        /* Navbar Customizada (Padrão para todos) */
        .navbar-custom {
            background-color: #ffffff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            border-bottom: 3px solid var(--primary-color);
        }
        .navbar-brand, .nav-link { color: var(--primary-color) !important; font-weight: 600; }
        .dropdown-item:hover { background-color: var(--primary-light); color: var(--primary-color); }

        /* Container de Notificações */
        .notification-wrapper {
            max-width: 900px;
            margin: 40px auto;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        /* Filtros */
        .filter-section {
            background: #fdfbff;
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
        }
        .form-label { font-size: 0.8rem; font-weight: 600; color: var(--primary-color); }
        .form-control, .form-select { border-radius: 8px; border: 1px solid #ddd; }

        /* Abas Estilizadas */
        .nav-tabs-custom {
            display: flex;
            background: #fff;
            border-bottom: 2px solid var(--border-color);
        }
        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            font-weight: 600;
            color: var(--text-muted);
            transition: all 0.3s;
            position: relative;
        }
        .tab-btn.active { color: var(--primary-color); }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary-color);
        }
        .badge-count { font-size: 0.7rem; vertical-align: middle; margin-left: 5px; }

        /* Lista de Itens */
        .notification-list { list-style: none; padding: 0; margin: 0; }
        .notification-item {
            display: flex;
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s;
            align-items: center;
        }
        .notification-item:hover { background-color: #fcfaff; }
        .notification-item.unread { background-color: #f8f5ff; border-left: 4px solid var(--primary-color); }

        .notif-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 1.2rem;
        }
        
        /* Cores Dinâmicas dos Ícones */
        .bg-urgent { background: #fff0f0; color: var(--status-danger); }
        .bg-warning { background: #fff9e6; color: var(--status-warning); }
        .bg-process { background: #e6ffed; color: var(--status-success); }

        .notif-content { flex-grow: 1; }
        .notif-title { font-weight: 700; font-size: 0.95rem; margin-bottom: 2px; display: block; }
        .notif-msg { font-size: 0.88rem; color: #555; margin: 0; }
        .notif-time { font-size: 0.75rem; color: #aaa; margin-top: 5px; display: block; }

        .empty-state { padding: 60px; text-align: center; color: #ccc; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">Secretaria da Mulher</a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mx-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">Contratos</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/contratos">Cadastro Contrato</a></li>
                        <li><a class="dropdown-item" href="/contrato_produto">Estoque Contrato</a></li>
                    </ul>
                </li>
                </ul>
            <div class="d-flex align-items-center">
                <a href="/notificacoes" class="nav-link px-3 position-relative">
                    <i class="fa-solid fa-bell fs-5"></i>
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size: 0.5rem;">
                        {{ nao_lidas|length }}
                    </span>
                </a>
            </div>
        </div>
    </div>
</nav>

<div class="notification-wrapper">
    <div class="filter-section">
        <form id="filter-form" class="row g-3 align-items-end" onsubmit="applyFilters(event)">
            <div class="col-md-3">
                <label class="form-label">Data Inicial</label>
                <input type="date" id="data_inicial" class="form-control" value="{{ data_inicial or '' }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">Data Final</label>
                <input type="date" id="data_final" class="form-control" value="{{ data_final or '' }}">
            </div>
            <div class="col-md-4">
                <label class="form-label">Nível de Alerta</label>
                <select id="alerta_filtro" class="form-select">
                    <option value="">Todos os alertas</option>
                    <option value="2" {% if alerta_filtro == '2' %}selected{% endif %}>Urgente (Nível 2)</option>
                    <option value="1" {% if alerta_filtro == '1' %}selected{% endif %}>Aviso (Nível 1)</option>
                    <option value="0" {% if alerta_filtro == '0' %}selected{% endif %}>Concluído (Nível 0)</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100" style="background: var(--primary-color); border:none; border-radius: 8px; padding: 8px;">
                    <i class="fa-solid fa-filter me-1"></i> Filtrar
                </button>
            </div>
        </form>
    </div>

    <div class="nav-tabs-custom">
        <button class="tab-btn active" onclick="openTab(event, 'all')">
            Todas <span class="badge rounded-pill bg-secondary badge-count">{{ todas|length }}</span>
        </button>
        <button class="tab-btn" onclick="openTab(event, 'unread')">
            Não Lidas <span class="badge rounded-pill bg-danger badge-count">{{ nao_lidas|length }}</span>
        </button>
        <button class="tab-btn" onclick="openTab(event, 'read')">
            Lidas <span class="badge rounded-pill bg-success badge-count">{{ lidas|length }}</span>
        </button>
    </div>

    <div id="all" class="tab-content-panel p-0">
        <ul class="notification-list">
            {% for registro in todas %}
            <li class="notification-item {% if registro.alerta > 0 %}unread{% endif %}">
                <div class="notif-icon {% if registro.alerta == 2 %}bg-urgent{% elif registro.alerta == 1 %}bg-warning{% else %}bg-process{% endif %}">
                    <i class="fa-solid {% if registro.alerta == 2 %}fa-triangle-exclamation{% elif registro.alerta == 1 %}fa-circle-exclamation{% else %}fa-check-double{% endif %}"></i>
                </div>
                <div class="notif-content">
                    <span class="notif-title">Ação em {{ registro.tabela | capitalize }}</span>
                    <p class="notif-msg">{{ registro.mensagem }}</p>
                    <span class="notif-time"><i class="fa-regular fa-clock me-1"></i> {{ registro.timestamp.strftime('%d/%m/%Y %H:%M') }}</span>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>

    </div>

<script>
    function openTab(evt, tabName) {
        const panels = document.querySelectorAll('.tab-content-panel');
        const buttons = document.querySelectorAll('.tab-btn');
        
        buttons.forEach(btn => btn.classList.remove('active'));
        evt.currentTarget.classList.add('active');
        
        // No seu caso, como o Jinja já renderizou, você pode filtrar via JS os elementos da lista
        // ou manter a lógica de carregar IDs diferentes como estava no seu original.
    }

    function applyFilters(event) {
        event.preventDefault();
        const dataInicial = document.getElementById('data_inicial').value;
        const dataFinal = document.getElementById('data_final').value;
        const alertaFiltro = document.getElementById('alerta_filtro').value;
        
        const params = new URLSearchParams();
        if (dataInicial) params.append('data_inicial', dataInicial);
        if (dataFinal) params.append('data_final', dataFinal);
        if (alertaFiltro !== '') params.append('alerta_filtro', alertaFiltro);
        
        window.location.href = window.location.pathname + '?' + params.toString();
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>